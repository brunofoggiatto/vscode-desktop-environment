#!/bin/bash

# Script auxiliar para iniciar sessão VS Code
# Este script pode ser chamado manualmente se necessário

LOG_FILE="/tmp/vscode-session.log"

echo "=== Iniciando VS Code Session $(date) ===" | tee -a "$LOG_FILE"

# Aguarda ambiente estar pronto
sleep 2

# Desabilita screensaver e power management
xset s off 2>/dev/null
xset -dpms 2>/dev/null
xset s noblank 2>/dev/null

echo "X11 configurado" | tee -a "$LOG_FILE"

# Define fundo preto
xsetroot -solid "#000000" 2>/dev/null

echo "Iniciando VS Code..." | tee -a "$LOG_FILE"

# Inicia VS Code com todas as otimizações
code \
    --disable-gpu \
    --disable-gpu-sandbox \
    --no-sandbox \
    --disable-dev-shm-usage \
    --start-fullscreen \
    --verbose 2>&1 | tee -a "$LOG_FILE" &

VSCODE_PID=$!
echo "VS Code iniciado (PID: $VSCODE_PID)" | tee -a "$LOG_FILE"

# Aguarda VS Code abrir
sleep 3

# Tenta forçar fullscreen usando wmctrl (se disponível)
if command -v wmctrl >/dev/null 2>&1; then
    wmctrl -r "Visual Studio Code" -b add,fullscreen 2>/dev/null
    echo "Fullscreen forçado via wmctrl" | tee -a "$LOG_FILE"
fi

echo "=== VS Code Session iniciada com sucesso ===" | tee -a "$LOG_FILE"

# Mantém o processo ativo
wait $VSCODE_PID